<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>문의하기 | AJAX (SPA 안전)</title>
  <meta name="description" content="스마트코어솔루션에 문의하세요">
  <style>
    body { background:#ffffff; color:#333; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; margin:0; }
    .container{max-width:820px;margin:0 auto;padding:24px}
    .card{background:#f8f9fa;border:1px solid #e9ecef;border-radius:16px;padding:24px;box-shadow:0 4px 20px rgba(0,0,0,.06)}
    h1{margin:0 0 10px 0;font-size:28px}
    p.desc{margin:0 0 16px 0;color:#666}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field.full{grid-column:1 / -1}
    label{font-weight:600;font-size:13px}
    label.required::after{content:" *"; color:#dc3545}
    input,select,textarea{padding:10px 12px;border:2px solid #dee2e6;border-radius:6px;font-size:14px;background:#fff;transition:all .2s}
    input:focus,select:focus,textarea:focus{border-color:#4a9eff;box-shadow:0 0 0 3px rgba(74,158,255,.12);outline:none}
    textarea{min-height:120px;resize:vertical}
    .privacy{margin-top:14px;padding:12px;background:#e9ecef;border-radius:10px;display:flex;gap:10px;align-items:flex-start}
    .actions{display:flex;gap:12px;justify-content:flex-end;align-items:center;margin-top:16px}
    button{background:#4a9eff;color:#fff;border:none;border-radius:8px;padding:12px 20px;font-weight:700;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .msg{display:none;margin-top:14px;padding:12px;border-radius:8px}
    .msg.ok{display:block;background:#d1e7dd;color:#0a3622;border:1px solid #badbcc}
    .msg.err{display:block;background:#f8d7da;color:#58151c;border:1px solid #f5c2c7}
    .note{font-size:12px;color:#6c757d}
    @media (max-width:768px){ .grid{grid-template-columns:1fr} .actions{flex-direction:column;align-items:stretch} button{width:100%} }
  </style>
</head>
<body>
  <div class="container">
    <h1>문의하기</h1>
    <p class="desc">라우터가 폼 제출을 가로채더라도, fetch로 직접 POST 하도록 구성했습니다.</p>

    <div class="card">
      <!-- ✅ AJAX 제출: 라우터 간섭을 완전히 회피 -->
      <form id="contactForm" novalidate>
        <!-- FormSubmit 옵션(본문으로 함께 전송) -->
        <input type="hidden" name="_subject" value="스마트코어솔루션 문의">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_autoresponse" value="문의해 주셔서 감사합니다. 확인 후 회신드리겠습니다.">
        <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off">

        <div class="grid">
          <div class="field">
            <label for="name" class="required">이름</label>
            <input id="name" name="name" type="text" placeholder="홍길동" required>
          </div>

          <div class="field">
            <label for="email" class="required">보내는사람 이메일</label>
            <input id="email" name="email" type="email" placeholder="you@example.com" required>
          </div>

          <div class="field">
            <label for="phone">연락처</label>
            <input id="phone" name="phone" type="tel" placeholder="010-1234-5678">
          </div>

          <div class="field">
            <label for="inquiry_type" class="required">문의 유형</label>
            <select id="inquiry_type" name="inquiry_type" required>
              <option value="">선택해주세요</option>
              <option>헬스케어 서비스</option>
              <option>스마트제조 서비스</option>
              <option>제휴 문의</option>
              <option>강의 문의</option>
              <option>기술 문의</option>
              <option>가격 문의</option>
              <option>기타</option>
            </select>
          </div>

          <div class="field full">
            <label for="subject" class="required">제목</label>
            <input id="subject" name="subject" type="text" placeholder="문의 제목을 입력하세요" required>
          </div>

          <div class="field full">
            <label for="message" class="required">내용</label>
            <textarea id="message" name="message" placeholder="문의 내용을 자세히 적어주세요." required></textarea>
          </div>
        </div>

        <div class="privacy">
          <input type="checkbox" id="privacy" required>
          <label for="privacy" class="note">개인정보 수집·이용에 동의합니다. (문의 응대 목적)</label>
        </div>

        <div class="actions">
          <span class="note">* 표시는 필수 입력</span>
          <button id="submitBtn" type="submit">보내기</button>
        </div>

        <div id="msg" class="msg" role="status" aria-live="polite"></div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById('contactForm');
    const btn  = document.getElementById('submitBtn');
    const msg  = document.getElementById('msg');

    function show(type, text){
      msg.className = 'msg ' + (type === 'ok' ? 'ok' : 'err');
      msg.textContent = text;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault(); // SPA 라우터/페이지 전환 방지

      // 기본 HTML5 검증
      if (!form.checkValidity()) {
        show('err', '필수 입력을 확인해 주세요.');
        return;
      }
      // 추가 이메일 형식 검증
      const email = document.getElementById('email').value.trim();
      if (!/^([^\s@]+)@([^\s@]+)\.[^\s@]+$/.test(email)) {
        show('err', '올바른 이메일 주소를 입력해 주세요.');
        return;
      }
      // 개인정보 동의
      if (!document.getElementById('privacy').checked) {
        show('err', '개인정보 수집·이용에 동의해 주세요.');
        return;
      }

      // FormData -> JSON
      const data = Object.fromEntries(new FormData(form).entries());

      btn.disabled = true;
      show('ok', '전송 중입니다…');
      try {
        // ✅ FormSubmit AJAX 엔드포인트 (SPA 안전)
        const res = await fetch('https://formsubmit.co/ajax/jangck11@naver.com', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(data)
        });

        // FormSubmit은 200/OK + JSON을 반환
        if (!res.ok) throw new Error('Network error');
        const json = await res.json();
        if (json && json.success === 'true') {
          // 성공 시 감사 페이지로 이동
          location.assign('/thank_you.html'); // 배포 경로에 맞게 조정
        } else {
          show('err', '전송 상태를 확인하지 못했습니다. 잠시 후 다시 시도해 주세요.');
        }
      } catch (err) {
        console.error(err);
        show('err', '전송 실패. 네트워크 상태 확인 후 다시 시도해 주세요.');
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
